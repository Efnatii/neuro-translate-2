<!doctype html>
<html lang="ru">
  <!--
    Debug entrypoint for MV3 diagnostics view.
    Responsibilities:
    - renders static containers for snapshot/patch diagnostics;
    - loads shared transport/runtime helpers before page controller;
    - keeps layout resilient to long event/meta text without horizontal scroll.
    Non-goals:
    - no background business logic or direct persistent-state reads,
    - no direct network/offscreen operations from the page.
  -->
  <head>
    <meta charset="utf-8">
    <title>Neuro Translate — Отладка</title>
    <link rel="stylesheet" href="/ui/debug.css">
  </head>
  <body>
    <main class="debug">
      <header>
        <h1 class="debug__title">Neuro Translate — Отладка</h1>
        <p class="debug__subtitle" data-field="site">Сайт: —</p>
        <p class="debug__subtitle debug__transport" data-field="transport">Transport: —</p>
        <p class="debug__subtitle debug__error" data-field="ui-error"></p>
      </header>

      <section>
        <div class="debug__label">Прогресс</div>
        <progress value="0" max="100" data-field="progress"></progress>
      </section>

      <section class="debug__status">
        <div class="debug__label">Статус</div>
        <div class="debug__row"><span>Completed</span><span data-field="completed">—</span></div>
        <div class="debug__row"><span>Total</span><span data-field="total">—</span></div>
        <div class="debug__row"><span>In progress</span><span data-field="inProgress">—</span></div>
        <div class="debug__row"><span>Message</span><span data-field="message">нет данных</span></div>
      </section>

      <section class="debug__status">
        <div class="debug__label">Decision</div>
        <div class="debug__row"><span>Policy</span><span data-field="decision-policy">—</span></div>
        <div class="debug__row"><span>Chosen model</span><span data-field="decision-model">—</span></div>
        <div class="debug__row"><span>Reason</span><span data-field="decision-reason">—</span></div>
      </section>

      <section class="debug__status">
        <div class="debug__label">Model Benchmarks</div>
        <div class="debug__row"><span>Status</span><span data-field="bench-status">—</span></div>
        <div class="debug__row"><span>Current model</span><span data-field="bench-current">—</span></div>
        <div class="debug__row"><span>Message</span><span data-field="bench-message">—</span></div>
        <table class="debug__table">
          <thead>
            <tr>
              <th>Model spec</th>
              <th>Median (ms)</th>
              <th>Updated</th>
            </tr>
          </thead>
          <tbody data-field="bench-table"></tbody>
        </table>
      </section>


      <section class="debug__status">
        <div class="debug__label">Rate limits</div>
        <div class="debug__row"><span>Current model</span><span data-field="rate-current-model">—</span></div>
        <div class="rate-head">
          <span>Model</span><span>RemReq</span><span>RemTok</span><span>Reserved</span><span>Cooldown</span><span>Reset</span>
        </div>
        <div class="rate-table" data-field="rate-table"></div>
      </section>

      <section class="debug__status">
        <div class="debug__label">Events</div>
        <div class="debug__controls">
          <select data-field="event-level">
            <option value="all">Level: all</option>
            <option value="info">Level: info</option>
            <option value="warn">Level: warn</option>
            <option value="error">Level: error</option>
          </select>
          <select data-field="event-tag">
            <option value="all">Tag: all</option>
          </select>
          <input type="text" placeholder="Search text" data-field="event-search">
          <button type="button" data-action="event-copy">Copy JSON</button>
          <button type="button" data-action="event-clear">Clear</button>
          <button type="button" data-action="event-older">Load older</button>
        </div>
        <div class="debug__event-log" id="eventList" data-field="event-log"></div>
      </section>
    </main>

    <script src="/core/nt-namespace.js"></script>
    <script src="/core/time.js"></script>
    <script src="/core/html.js"></script>
    <script src="/core/retry-loop.js"></script>
    <script src="/core/message-envelope.js"></script>
    <script src="/core/ui-protocol.js"></script>
    <script src="/core/message-bus.js"></script>
    <script src="/core/ui-port-client.js"></script>
    <script src="/ui/ui-module.js"></script>
    <script src="/ui/debug.js"></script>
  </body>
</html>
