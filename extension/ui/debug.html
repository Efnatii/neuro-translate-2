<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Neuro Translate - Панель оператора</title>
    <link rel="stylesheet" href="./debug.css">
  </head>
  <body>
    <main class="debug" id="debugRoot">
      <header class="debug__header">
        <div class="debug__title-wrap">
          <h1 class="debug__title">Панель оператора</h1>
          <div class="debug__sub" data-field="header-job">tab: - | job: -</div>
          <div class="debug__sub" data-field="header-state">status: - | stage: -</div>
          <div class="debug__sub" data-field="header-runtime">lease: - | retry: - | offscreen: - | activeRequests: -</div>
        </div>
        <div class="debug__header-actions">
          <button type="button" class="debug__btn" data-action="export-json">Экспорт отчета JSON</button>
          <button type="button" class="debug__btn" data-action="export-html">Экспорт HTML</button>
          <button type="button" class="debug__btn" data-action="copy-diagnostics">Копировать диагностику</button>
          <button type="button" class="debug__btn debug__btn--primary" data-action="kick-scheduler">Пнуть планировщик</button>
        </div>
      </header>

      <div class="debug__layout">
        <aside class="debug__nav" aria-label="Разделы">
          <a href="#overview" data-route-link="overview">1. Обзор</a>
          <a href="#plan" data-route-link="plan">2. План</a>
          <a href="#tools" data-route-link="tools">3. Инструменты</a>
          <a href="#diff-patches" data-route-link="diff-patches">4. Diff / Патчи</a>
          <a href="#categories" data-route-link="categories">5. Категории</a>
          <a href="#memory" data-route-link="memory">6. Память</a>
          <a href="#ratelimits" data-route-link="ratelimits">7. Rate limits</a>
          <a href="#perf" data-route-link="perf">8. Perf</a>
          <a href="#security" data-route-link="security">9. Security audit</a>
          <a href="#export" data-route-link="export">10. Export</a>
        </aside>

        <section class="debug__content">
          <section class="debug__panel" data-route="overview">
            <h2>Обзор</h2>
            <div class="debug__kv" data-field="overview-kv"></div>
            <div class="debug__row-actions">
              <button type="button" class="debug__btn" data-action="cancel-job">Отменить</button>
              <button type="button" class="debug__btn" data-action="erase-job">Стереть</button>
              <button type="button" class="debug__btn" data-action="kick-scheduler">Пнуть планировщик</button>
              <button type="button" class="debug__btn" data-action="copy-diagnostics">Копировать диагностику</button>
            </div>
          </section>

          <section class="debug__panel" data-route="plan" hidden>
            <h2>План (taxonomy + pipeline)</h2>
            <div class="debug__hint" data-field="plan-hint"></div>
            <div class="debug__table-wrap">
              <table class="debug__table">
                <thead>
                  <tr>
                    <th>id</th>
                    <th>titleRu</th>
                    <th>defaultTranslate</th>
                    <th>countUnits</th>
                    <th>routingSummary</th>
                    <th>batchingSummary</th>
                    <th>contextSummary</th>
                    <th>qcSummary</th>
                  </tr>
                </thead>
                <tbody data-field="plan-categories"></tbody>
              </table>
            </div>
            <div class="debug__hint" data-field="plan-mapping"></div>
          </section>

          <section class="debug__panel" data-route="tools" hidden>
            <h2>Инструменты (tool trace)</h2>
            <div class="debug__filters">
              <select data-field="tools-filter-name"></select>
              <select data-field="tools-filter-status">
                <option value="all">status: all</option>
                <option value="ok">ok</option>
                <option value="failed">failed</option>
                <option value="coalesced">coalesced</option>
                <option value="skipped">skipped</option>
              </select>
              <input type="text" data-field="tools-filter-search" placeholder="Поиск по trace">
              <button type="button" class="debug__btn" data-action="copy-tools-50">Скопировать последние 50</button>
            </div>
            <div class="debug__table-wrap debug__table-wrap--tall">
              <table class="debug__table">
                <thead>
                  <tr>
                    <th>ts</th>
                    <th>tool</th>
                    <th>status</th>
                    <th>args</th>
                    <th>result</th>
                  </tr>
                </thead>
                <tbody data-field="tools-table"></tbody>
              </table>
            </div>
            <pre class="debug__pre" data-field="tools-details">Выберите строку для деталей</pre>
          </section>

          <section class="debug__panel" data-route="diff-patches" hidden>
            <h2>Diff / Патчи</h2>
            <div class="debug__split">
              <div>
                <div class="debug__filters">
                  <input type="text" data-field="diff-filter-category" placeholder="category filter">
                  <input type="text" data-field="diff-filter-status" placeholder="status filter">
                </div>
                <div class="debug__list" data-field="diff-blocks"></div>
              </div>
              <div>
                <div class="debug__diff-head">Оригинал / Перевод</div>
                <div class="debug__diff-grid">
                  <pre class="debug__pre" data-field="diff-original">-</pre>
                  <pre class="debug__pre" data-field="diff-translated">-</pre>
                </div>
                <div class="debug__row-actions">
                  <button type="button" class="debug__btn" data-action="block-literal">Сделать дословно</button>
                  <button type="button" class="debug__btn" data-action="block-style">Улучшить стиль</button>
                  <button type="button" class="debug__btn" data-action="block-proofread">Вычитать</button>
                </div>
                <div class="debug__hint" data-field="diff-meta">modelUsed: - | routeUsed: - | updatedAt: -</div>
              </div>
            </div>
            <h3>Patch history</h3>
            <div class="debug__filters">
              <input type="text" data-field="patch-filter-block" placeholder="blockId">
              <select data-field="patch-filter-kind">
                <option value="all">kind: all</option>
                <option value="delta">delta</option>
                <option value="final">final</option>
                <option value="restore">restore</option>
              </select>
              <input type="text" data-field="patch-filter-phase" placeholder="phase">
            </div>
            <div class="debug__table-wrap debug__table-wrap--tall">
              <table class="debug__table">
                <thead>
                  <tr>
                    <th>seq</th>
                    <th>ts</th>
                    <th>kind</th>
                    <th>blockId</th>
                    <th>hash</th>
                    <th>preview</th>
                  </tr>
                </thead>
                <tbody data-field="patch-table"></tbody>
              </table>
            </div>
            <pre class="debug__pre" data-field="patch-details">Выберите патч для деталей</pre>
          </section>

          <section class="debug__panel" data-route="categories" hidden>
            <h2>Категории</h2>
            <div class="debug__hint" data-field="categories-hint"></div>
            <div class="debug__list" data-field="categories-list"></div>
            <div class="debug__row-actions">
              <button type="button" class="debug__btn" data-action="apply-categories">Применить выбор категорий</button>
              <button type="button" class="debug__btn" data-action="reclassify">Пересчитать классификацию</button>
            </div>
          </section>

          <section class="debug__panel" data-route="memory" hidden>
            <h2>Память</h2>
            <div class="debug__kv" data-field="memory-kv"></div>
            <div class="debug__row-actions">
              <button type="button" class="debug__btn" data-action="erase-memory-page">Стереть память этой страницы</button>
              <button type="button" class="debug__btn" data-action="erase-memory-all">Стереть всю память</button>
            </div>
          </section>

          <section class="debug__panel" data-route="ratelimits" hidden>
            <h2>Rate limits</h2>
            <div class="debug__kv" data-field="ratelimits-kv"></div>
            <div class="debug__list" data-field="ratelimits-list"></div>
          </section>

          <section class="debug__panel" data-route="perf" hidden>
            <h2>Perf</h2>
            <div class="debug__kv" data-field="perf-kv"></div>
            <div class="debug__list" data-field="perf-top"></div>
          </section>

          <section class="debug__panel" data-route="security" hidden>
            <h2>Security audit</h2>
            <div class="debug__hint" data-field="security-summary"></div>
            <pre class="debug__pre" data-field="security-json">-</pre>
            <div class="debug__row-actions">
              <button type="button" class="debug__btn" data-action="run-security-audit">Запустить Security audit</button>
              <button type="button" class="debug__btn" data-action="repair-all">Repair/Compact</button>
            </div>
          </section>

          <section class="debug__panel" data-route="export" hidden>
            <h2>Export</h2>
            <label class="debug__label" for="export-text-mode">includeTextMode</label>
            <select id="export-text-mode" class="debug__input" data-field="export-text-mode">
              <option value="snippets">snippets</option>
              <option value="none">none</option>
              <option value="full">full</option>
            </select>
            <div class="debug__hint">full может содержать фрагменты текста страницы; ключи все равно маскируются.</div>
            <div class="debug__row-actions">
              <button type="button" class="debug__btn" data-action="export-json">Скачать JSON</button>
              <button type="button" class="debug__btn" data-action="export-html">Скачать HTML</button>
              <button type="button" class="debug__btn" data-action="copy-diagnostics">Копировать диагностику</button>
            </div>
            <div class="debug__hint" data-field="export-status">-</div>
          </section>
        </section>
      </div>

      <div class="nt-toast-host" data-field="toast-host" aria-live="polite"></div>
    </main>

    <script src="../core/nt-namespace.js"></script>
    <script src="../core/message-envelope.js"></script>
    <script src="../core/ui-protocol.js"></script>
    <script src="../core/redaction.js"></script>
    <script src="./ui-i18n-ru.js"></script>
    <script src="./ui-kit.js"></script>
    <script src="./ui-protocol-client.js"></script>
    <script src="./report-exporter.js"></script>
    <script src="./debug.js"></script>
  </body>
</html>
